<fd-select [placeholder]="placeholder"
[glyph]="glyph"
[compact]="isCompact"
[disabled]="disabled"
[readonly]="readonly"
[closeOnOutsideClick]="closeOnOutsideClick"
[controlTemplate]="controlTemplate"
[appendTo]="appendTo"
[fillControlMode]="fillControlMode"
[maxHeight]="maxHeight"
[attr.aria-disabled]="disabled || readonly"
[attr.aria-readonly]="readonly"
[attr.role]="'listbox'"
[value]="value"
[state]="state"
[stateMessage]="stateMessage"
[mobile]="mobile"
[mobileConfig]="mobileConfig"
[(ngModel)]="value"
(valueChange)="_onSelection($event)">

    <fd-option *ngIf="noValueLabel" [disabled]="false" [value]="null">
        {{noValueLabel}}
    </fd-option>
    <fd-option *ngFor="let item of _optionItems; index as index"
               [disabled]="item.disabled ? true : false"
               [value]="item"
               [attr.aria-labelledby]="ariaLabel"
               [attr.aria-disabled]="disabled">
            <fd-icon [glyph]="item.icon" class="fd-template-icon icon-margin"></fd-icon>
           <span fd-list-title>{{item.label ? item.label : item }}</span>
   <span fd-list-secondary>{{item.secondaryText ? item.secondaryText : '' }}</span>
    </fd-option>
 </fd-select>

<ng-template #listTemplate>

        <ng-container *ngIf="isGroup">
            <ng-container *ngFor="let group of _optionItems">
                <ng-container *ngIf="!_groupItemTemplate">
                    <li fd-list-group-header role="group" [innerText]="group.label"></li>
                </ng-container>

                <ng-container *ngIf="_groupItemTemplate">
                    <ng-container [ngTemplateOutlet]="_groupItemTemplate"
                                  [ngTemplateOutletContext]="{$implicit: {label: group.label}}"></ng-container>
                </ng-container>

                <li *ngFor="let optionItem of group.children; let i = index;"
                    (click)="handleOptionItem(optionItem)"
                    fd-list-item
                    role="option"
                    tabindex="0"
                    (keyDown)="handlePressEnter($event, optionItem)"
                    [selected]="_isSelectedOptionItem(optionItem)">
                    <ng-container [ngTemplateOutlet]="listItem"
                                  [ngTemplateOutletContext]="{ optionItem: optionItem, index: i }"></ng-container>
                </li>
            </ng-container>
        </ng-container>

        <ng-container *ngIf="!isGroup">
            <li *ngFor="let optionItem of _optionItems; let i = index;"
                (click)="handleOptionItem(optionItem)"
                fd-list-item
                role="option"
                tabindex="0"
                (keyDown)="handlePressEnter($event, optionItem)"
                [selected]="_isSelectedOptionItem(optionItem)">
                <ng-container [ngTemplateOutlet]="listItem"
                              [ngTemplateOutletContext]="{ optionItem: optionItem, index: i }"></ng-container>
            </li>
        </ng-container>
</ng-template>

<ng-template let-optionItem="optionItem" let-index="index" #listItem>
    <ng-container *ngIf="_isSelectedOptionItem(optionItem) && !!_selectedItemTemplate"
                  [ngTemplateOutlet]="_selectedItemTemplate"
                  [ngTemplateOutletContext]="{ $implicit: optionItem.value, index: index }"></ng-container>

    <ng-container *ngIf="!(_isSelectedOptionItem(optionItem) && _selectedItemTemplate)">
        <ng-container [ngTemplateOutlet]="optionItemSource"
                      [ngTemplateOutletContext]="{ optionItem: optionItem, index: index }"></ng-container>

        <ng-container [ngTemplateOutlet]="secondaryTextSource"
                      [ngTemplateOutletContext]="{ optionItem: optionItem }"></ng-container>
    </ng-container>
</ng-template>

<ng-template let-optionItem="optionItem" let-index="index" #optionItemSource>
    <ng-container *ngIf="!_optionItemTemplate">
        <span [innerHTML]="optionItem.label"></span>
    </ng-container>

    <ng-container *ngIf="_optionItemTemplate">
        <ng-container [ngTemplateOutlet]="_optionItemTemplate"
                      [ngTemplateOutletContext]="{$implicit: optionItem.value, index: index}"></ng-container>
    </ng-container>
</ng-template>

<ng-template let-optionItem="optionItem" #secondaryTextSource>
    <ng-container *ngIf="showSecondaryText">
        <ng-container *ngIf="!_secondaryItemTemplate">
            <span [style.text-align]="secondaryTextAlignment" fd-list-secondary [innerHTML]="optionItem.secondaryText"></span>
        </ng-container>

        <ng-container *ngIf="_secondaryItemTemplate">
            <ng-container [ngTemplateOutlet]="_secondaryItemTemplate"
                          [ngTemplateOutletContext]="{$implicit: optionItem.value}"></ng-container>
        </ng-container>
    </ng-container>
</ng-template>
